## 📌 목적

MRI 이미지 데이터를 체계적으로 정리하고,

향후 뷰어, 필터링, 자동 분류 기능에 대응 가능한 구조를 갖추기 위해

**폴더 구조와 메타데이터 관리 방식**을 정의한다.

---

## 1. 초기 데이터 구조

### 🖼️ 파일명 예시

```
1-01-025-MRI-0254-250131_0000_Internal_carotid_artery.jpg
```

### 📚 구성 요소 설명

| 항목 | 의미 |
| --- | --- |
| `1-01-025` | 단면 시퀀스 ID (후에 환자 단위로 묶임: `01-025`, 맨 앞 `1`은 단면 시퀀스 순서) |
| `MRI-0254` | 단면 구분용 스캔 넘버 (단면에 따라 증가, 예: 다음 단면은 `MRI-0255`) |
| `250131` | 촬영일자 (예: 2025년 1월 31일) |
| `_0000_` | 마스크 이미지의 순차 넘버링 (부위별 단순 순서, ID 아님. 다음은 `0001`) |
| `Internal_carotid_artery` | 마스크 대상 해부학적 부위명 (공백 대신 `_`) |

---

## 2. 단면 → 환자 → 상위 분류 확장

- `1-01-025`, `2-01-025`, `3-01-025` 등은 모두 **동일한 환자(`Layer-01-025`)**의 단면을 의미
- 단면 시퀀스를 하나로 묶어서 "환자 단위" 디렉토리 구성 가능

---

## 3. 상위 개념 도입 고민

### ❓ 문제

단순한 단면/페이지 구조만으로는:

- 데이터가 많아졌을 때 관리 어려움
- 증상 기반 필터링이나 부위별 분류가 어려움

### ✅ 해결 방향

- 환자보다 상위 개념으로 **신체 부위(bodyPart)** 와 **증상(symptoms)** 을 메타데이터에 포함
- 디렉토리 구조로도 해당 정보를 반영

---

## 4. 최종 디렉토리 구조

```
/mri-images/
  /[신체 부위]/            ← 뇌, 팔, 다리, 전신 등
    /[증상]/               ← 마비, 저림, 통증, 시야장애 등
      /[환자 ID]/          ← Layer-01-025
        /[페이지네이션]/    ← page-1, page-2 등 (단면 묶음 단위)
          /[단면 레이어]/  ← 1-01-025-MRI-0254-250131, 2-01-025-MRI-0255-250131
            - base.jpg
            - meta.json
            - masks/

```

---

## 5. 메타데이터 (`meta.json`) 예시

```json
{
  "base": "1-01-025-MRI-0254-250131_0016_main.jpg",
  "bodyPart": "뇌",
  "symptoms": ["마비", "시야장애"],
  "masks": [
    {
      "filename": "1-01-025-MRI-0254-250131_0000_Internal_carotid_artery.png",
      "label": "Internal carotid artery",
      "visible": true}
  ]
}

```

### ✔️ 주요 필드 설명

| 필드명 | 설명 |
| --- | --- |
| `base` | 배경이 되는 원본 이미지 (main) |
| `bodyPart` | 해당 케이스의 신체 부위 |
| `symptoms` | 해당 환자의 증상 목록 (복수 가능) |
| `masks` | 각 마스크 이미지의 filename, label, visible 여부 |

---

## 6. 자동화 스크립트 구성 (`process.js`)

- 역할:
    - `.jpg` → `.png` 변환
    - 공백 제거
    - `meta.json` 자동 생성
- 개선 사항:
    - 스크립트 상단에 `const bodyPart = "뇌"; const symptoms = ["마비"];` 형태로 직접 입력
    - 현재 신체 부위 -> 증상의 데이터는 미지수
    - `meta.json` 생성 시 자동 포함

---

## 7. 확장 가능성 & 고려사항

| 항목 | 설명 |
| --- | --- |
| 케이스 수 | 30건 이하는 지금 구조로 충분, 50건 이상이면 메타시트 자동화 고려 |
| 부위/증상 조합 | 부위 기준 상위 폴더 구조 유지, 증상은 하위 폴더로 분류 |
| 진단 정보 | 현재는 없음, 향후 의학적 라벨 추가 시 별도 필드 도입 가능 |
| UI 필터링 | `bodyPart`, `symptoms` 기준 필터링 가능 (뷰어 연계 준비 완료) |

---

## ✅ 결론

- 현재는 케이스 수가 미지수고 임의로 넣는 것이기 때문에, **간단한 string 변수 입력 방식**으로 `meta.json` 구성
- 디렉토리 구조는 `부위 > 증상 > 환자 > 페이지 > 단면` 으로 구성하여 **확장성과 명확성 확보**
- 향후 데이터가 많아지면 `metadata.csv` 또는 중앙 관리 JSON으로 전환 가능